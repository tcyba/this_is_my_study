# ä»Šå¤©æ€»ç»“ä¸€äº›javaæ¼æ´é‡Œçš„å¸¸è§åè¯ï¼



å¼•ç”¨æ–‡ç« ï¼š

`https://mp.weixin.qq.com/s?__biz=MzI5Mzk5NTIwMg==&mid=2247486510&idx=1&sn=1240f64a1e017736c8aef006b577bc66`

`https://www.freebuf.com/vuls/279465.html`



## Java EE çš„æ ¸å¿ƒæŠ€æœ¯

Java EE æœ‰åä¸‰ç§æ ¸å¿ƒæŠ€æœ¯ï¼Œå®ƒä»¬åˆ†åˆ«æ˜¯ï¼šJDBCã€JNDIã€EJBã€RMIã€Servletã€JSPã€XMLã€JMSã€Java IDLã€JTSã€JTAã€JavaMail å’Œ JAFï¼Œè¿™é‡Œé‡ç‚¹ä»‹ç»ä»¥ä¸‹å‡ ç§ï¼š

1. Java æ•°æ®åº“è¿æ¥ï¼ˆJava Database Connectivityï¼Œ**JDBC**ï¼‰æ˜¯ Java è¯­è¨€ä¸­ç”¨æ¥è§„èŒƒå®¢æˆ·ç«¯ç¨‹åºå¦‚ä½•æ¥è®¿é—®æ•°æ®åº“çš„åº”ç”¨ç¨‹åºæ¥å£ï¼Œæä¾›äº†è¯¸å¦‚æŸ¥è¯¢å’Œæ›´æ–°æ•°æ®åº“ä¸­æ•°æ®çš„æ–¹æ³•ã€‚

2. Java å‘½åå’Œç›®å½•æ¥å£ï¼ˆJava Naming and Directory Interfaceï¼Œ**JNDI**ï¼‰ï¼Œæ˜¯ Java çš„ä¸€ä¸ªç›®å½•æœåŠ¡åº”ç”¨ç¨‹åºç•Œé¢ï¼ˆAPIï¼‰ï¼Œå®ƒæä¾›ä¸€ä¸ªç›®å½•ç³»ç»Ÿï¼Œå¹¶å°†æœåŠ¡åç§°ä¸å¯¹è±¡å…³è”èµ·æ¥ï¼Œä»è€Œä½¿å¾—å¼€å‘äººå‘˜åœ¨å¼€å‘è¿‡ç¨‹ä¸­å¯ä»¥ä½¿ç”¨åç§°æ¥è®¿é—®å¯¹è±¡ã€‚

   **ç®€å•çš„è¯´å°±æ˜¯æ¯”å¦‚ä»¥å‰è¿æ¥æ•°æ®åº“éœ€è¦æŠŠå‚æ•°å†™åœ¨ Java ç±»é‡Œï¼Œä½†ç°åœ¨å¯ä»¥ç›´æ¥å†™åœ¨é…ç½®æ–‡ä»¶é‡Œäº†ï¼Œè¿™ä¸ªé…ç½®æ–‡ä»¶å¯ä»¥æ˜¯ XMLï¼Œä¹Ÿå¯ä»¥æ˜¯ propertiesï¼Œæˆ–è€… yml æ–‡ä»¶ï¼Œåªè¦èƒ½è§£æéƒ½è¡Œã€‚**

3. ä¼ä¸šçº§ JavaBeanï¼ˆEnterprise JavaBean, EJBï¼‰æ˜¯ä¸€ä¸ªç”¨æ¥æ„ç­‘ä¼ä¸šçº§åº”ç”¨çš„ã€åœ¨æœåŠ¡å™¨ç«¯å¯è¢«ç®¡ç†ç»„ä»¶ã€‚JavaBean ä¸ªäººå­¦ä¹ çš„æ—¶å€™ç†è§£JavaBeanå°±æ˜¯å®ä½“ç±»ï¼

   ä¸è¿‡è¿™ä¸ªä¸œè¥¿åœ¨ Spring é—®ä¸–ååŸºæœ¬å‡‰å‡‰äº†ï¼ŒçŸ¥é“æ˜¯ä»€ä¹ˆå°±è¡Œã€‚

4. è¿œç¨‹æ–¹æ³•è°ƒç”¨ï¼ˆRemote Method Invocationï¼Œ**RMI**ï¼‰æ˜¯ Java çš„ä¸€ç»„æ‹¥æœ‰å¼€å‘åˆ†å¸ƒå¼åº”ç”¨ç¨‹åºçš„ APIï¼Œå®ƒå¤§å¤§å¢å¼ºäº† Java å¼€å‘åˆ†å¸ƒå¼åº”ç”¨çš„èƒ½åŠ›ã€‚

5. Servletï¼ˆServer Appletï¼‰ï¼Œæ˜¯ç”¨ Java ç¼–å†™çš„æœåŠ¡å™¨ç«¯ç¨‹åºã€‚

   å…¶ä¸»è¦åŠŸèƒ½åœ¨äºäº¤äº’å¼åœ°æµè§ˆå’Œä¿®æ”¹æ•°æ®ï¼Œç”ŸæˆåŠ¨æ€ Web å†…å®¹ã€‚

   ç‹­ä¹‰çš„ Servlet æ˜¯æŒ‡ Java è¯­è¨€å®ç°çš„ä¸€ä¸ªæ¥å£ï¼Œå¹¿ä¹‰çš„ Servlet æ˜¯æŒ‡ä»»ä½•å®ç°äº†è¿™ä¸ª Servlet æ¥å£çš„ç±»ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ï¼Œäººä»¬å°† Servlet ç†è§£ä¸ºåè€…ã€‚

6. JSPï¼ˆå…¨ç§° JavaServer Pagesï¼‰æ˜¯ç”± Sun å…¬å¸ä¸»å¯¼åˆ›å»ºçš„ä¸€ç§åŠ¨æ€ç½‘é¡µæŠ€æœ¯æ ‡å‡†ã€‚

   JSP éƒ¨ç½²äºç½‘ç»œæœåŠ¡å™¨ä¸Šï¼Œå¯ä»¥å“åº”å®¢æˆ·ç«¯å‘é€çš„è¯·æ±‚ï¼Œå¹¶æ ¹æ®è¯·æ±‚å†…å®¹åŠ¨æ€åœ°ç”Ÿæˆ HTMLã€XML æˆ–å…¶ä»–æ ¼å¼æ–‡æ¡£çš„ Web ç½‘é¡µï¼Œç„¶åè¿”å›ç»™è¯·æ±‚è€…ã€‚

7. å¯æ‰©å±•æ ‡è®°è¯­è¨€ï¼ˆeXtensible Markup Languageï¼ŒXMLï¼‰æ˜¯è¢«è®¾è®¡ç”¨äºä¼ è¾“å’Œå­˜å‚¨æ•°æ®çš„è¯­è¨€ã€‚

8. Java æœåŠ¡æ¶ˆæ¯ï¼ˆJava Message Serviceï¼ŒJMSï¼‰æ˜¯ä¸€ä¸ª Java å¹³å°ä¸­å…³äºé¢å‘æ¶ˆæ¯ä¸­é—´ä»¶ï¼ˆMOMï¼‰çš„ APIï¼Œç”¨äºåœ¨ä¸¤ä¸ªåº”ç”¨ç¨‹åºä¹‹é—´æˆ–åˆ†å¸ƒå¼ç³»ç»Ÿä¸­å‘é€æ¶ˆæ¯ï¼Œè¿›è¡Œå¼‚æ­¥é€šä¿¡ã€‚

9.  **JNI** ã€‚ Javaè¯­è¨€æ˜¯åŸºäºCè¯­è¨€å®ç°çš„ï¼ŒJavaåº•å±‚çš„å¾ˆå¤šAPIéƒ½æ˜¯é€šè¿‡`JNI(Java Native Interface)`æ¥å®ç°çš„ã€‚

10. 





## åå°„

`åå°„ã€ç±»åŠ è½½ã€RPCã€åŠ¨æ€ä»£ç†ç­‰ã€‚è¿™äº›æ¦‚å¿µæ˜¯javaæ¼æ´åˆ©ç”¨çš„åŸºç¡€ï¼Œä¾‹å¦‚shiroååºåˆ—åŒ–ï¼Œfastjsonååºåˆ—åŒ–ç­‰ã€‚`

å¼•ç”¨æ–‡ç« ï¼š`https://mp.weixin.qq.com/s?__biz=MzI4Mzc0MTI0Mw==&mid=2247491725&idx=1&sn=5b51624f6474fe905e6f95d6b8e1a0e0`

![image-20211116153850417](D:\oneDriveäº‘å­˜å‚¨\OneDrive\æ¡Œé¢\javaä»£ç å®¡è®¡å­¦èµ·\æˆ‘çš„å­¦ä¹ é¡¹ç›®\this_is_my_study\javaä»£ç å®¡è®¡å­¦èµ·\javaä»£ç å®¡è®¡6.assets\image-20211116153850417.png)

```java

// 1.é€šè¿‡å­—ç¬¦ä¸²è·å–Classå¯¹è±¡ï¼Œè¿™ä¸ªå­—ç¬¦ä¸²å¿…é¡»å¸¦ä¸Šå®Œæ•´è·¯å¾„å
Class studentClass = Class.forName("com.test.reflection.Student");
// 2.è·å–å£°æ˜çš„æ„é€ æ–¹æ³•ï¼Œä¼ å…¥æ‰€éœ€å‚æ•°çš„ç±»åï¼Œå¦‚æœæœ‰å¤šä¸ªå‚æ•°ï¼Œç”¨','è¿æ¥å³å¯
Constructor studentConstructor = studentClass.getDeclaredConstructor(String.class);
// å¦‚æœæ˜¯ç§æœ‰çš„æ„é€ æ–¹æ³•ï¼Œéœ€è¦è°ƒç”¨ä¸‹é¢è¿™ä¸€è¡Œä»£ç ä½¿å…¶å¯ä½¿ç”¨ï¼Œå…¬æœ‰çš„æ„é€ æ–¹æ³•åˆ™ä¸éœ€è¦ä¸‹é¢è¿™ä¸€è¡Œä»£ç 
studentConstructor.setAccessible(true);
// ä½¿ç”¨æ„é€ æ–¹æ³•çš„newInstanceæ–¹æ³•åˆ›å»ºå¯¹è±¡ï¼Œä¼ å…¥æ„é€ æ–¹æ³•æ‰€éœ€å‚æ•°ï¼Œå¦‚æœæœ‰å¤šä¸ªå‚æ•°ï¼Œç”¨','è¿æ¥å³å¯
Object student = studentConstructor.newInstance("å°æ˜");
// 3.è·å–å£°æ˜çš„å­—æ®µï¼Œä¼ å…¥å­—æ®µå

Field studentAgeField = studentClass.getDeclaredField("studentAge");

// å¦‚æœæ˜¯ç§æœ‰çš„å­—æ®µï¼Œéœ€è¦è°ƒç”¨ä¸‹é¢è¿™ä¸€è¡Œä»£ç ä½¿å…¶å¯ä½¿ç”¨ï¼Œå…¬æœ‰çš„å­—æ®µåˆ™ä¸éœ€è¦ä¸‹é¢è¿™ä¸€è¡Œä»£ç 
// studentAgeField.setAccessible(true);

// ä½¿ç”¨å­—æ®µçš„setæ–¹æ³•è®¾ç½®å­—æ®µå€¼ï¼Œä¼ å…¥æ­¤å¯¹è±¡ä»¥åŠå‚æ•°å€¼

studentAgeField.set(student,10);

// 4.è·å–å£°æ˜çš„å‡½æ•°ï¼Œä¼ å…¥æ‰€éœ€å‚æ•°çš„ç±»åï¼Œå¦‚æœæœ‰å¤šä¸ªå‚æ•°ï¼Œç”¨','è¿æ¥å³å¯

Method studentShowMethod = studentClass.getDeclaredMethod("show",String.class);

// å¦‚æœæ˜¯ç§æœ‰çš„å‡½æ•°ï¼Œéœ€è¦è°ƒç”¨ä¸‹é¢è¿™ä¸€è¡Œä»£ç ä½¿å…¶å¯ä½¿ç”¨ï¼Œå…¬æœ‰çš„å‡½æ•°åˆ™ä¸éœ€è¦ä¸‹é¢è¿™ä¸€è¡Œä»£ç 
studentShowMethod.setAccessible(true);
// ä½¿ç”¨å‡½æ•°çš„invokeæ–¹æ³•è°ƒç”¨æ­¤å‡½æ•°ï¼Œä¼ å…¥æ­¤å¯¹è±¡ä»¥åŠå‡½æ•°æ‰€éœ€å‚æ•°ï¼Œå¦‚æœæœ‰å¤šä¸ªå‚æ•°ï¼Œç”¨','è¿æ¥å³å¯ã€‚å‡½æ•°ä¼šè¿”å›ä¸€ä¸ªObjectå¯¹è±¡ï¼Œä½¿ç”¨å¼ºåˆ¶ç±»å‹è½¬æ¢è½¬æˆå®é™…ç±»å‹å³å¯

Object result = studentShowMethod.invoke(student,"message");

System.out.println("result: " + result);
```



å¸ˆå‚…ä¸€ç¼• æˆ‘æ„Ÿè§‰ç»ˆäºç»ˆäºæ‡‚äº†ï¼ğŸ‘¾ğŸ‘¾ğŸ‘¾ğŸ‘¾ğŸ‘¾



### æ¡ˆä¾‹

åˆ©ç”¨javaçš„åå°„å»æ‰§è¡Œå‘½ä»¤ã€‚

javaä¸­å¯ä»¥ç”¨`Runtime.getRuntime().exec("calc");`

ç”¨åå°„å®ç°

```java
        // è·å–Classå¯¹è±¡
        //Classå¯¹è±¡ é‡Œä¿å­˜æ˜¯Runtimeç±»çš„ä¿¡æ¯   javaé‡Œæ¯ä¸€ä¸ªç±»éƒ½æœ‰ä¸€ä¸ªClasså¯¹è±¡
        Class runtimeClass1 = Class.forName("java.lang.Runtime");

//        Object m = runtimeClass1.newInstance(); // Runtimeç±»æ˜¯æ„é€ å‡½æ•°æ˜¯ç§æœ‰çš„ æ— æ³•ç›´æ¥newå¯¹è±¡

        Method method = runtimeClass1.getMethod("exec", String.class);//è°ƒç”¨Runtimeç±» execæ–¹æ³•
        Method getRuntime = runtimeClass1.getMethod("getRuntime");//è°ƒç”¨Runtimeç±» getRuntimeæ–¹æ³•
        Object run = getRuntime.invoke(runtimeClass1);//é€šè¿‡invokeè°ƒç”¨å¯¹è±¡ çš„æ–¹æ³• è¿™é‡Œé€šè¿‡invokeè°ƒç”¨Classå¯¹è±¡ é‡Œçš„getRuntimeæ–¹æ³• newäº†ä¸ªRuntimeå¯¹è±¡
        method.invoke(run,"calc"); // æœ€åé€šè¿‡invokeè°ƒç”¨Runtimeå¯¹è±¡ é‡Œçš„execæ–¹æ³•
```



è¿˜å¯ä»¥`setAccessible(true)`æ¥çªç ´privateçš„é™åˆ¶ï¼Œ



```java
        Class<?> run = Class.forName("java.lang.Runtime");//CLASSå¯¹è±¡

        Constructor<?> c = run.getDeclaredConstructor();//è·å–Runtimeç±»æ„é€ æ–¹æ³•

        c.setAccessible(true);//å¯ä»¥è·å–ç§æœ‰æ„é€ æ–¹æ³•


        Object o = c.newInstance();//newä¸€ä¸ªå¯¹è±¡

        Method method = run.getMethod("exec", String.class);//è·å–Runtimeç±»çš„execæ–¹æ³•

        method.invoke(o,"calc");// invokeè°ƒç”¨
```

![image-20211116160747307](D:\oneDriveäº‘å­˜å‚¨\OneDrive\æ¡Œé¢\javaä»£ç å®¡è®¡å­¦èµ·\æˆ‘çš„å­¦ä¹ é¡¹ç›®\this_is_my_study\javaä»£ç å®¡è®¡å­¦èµ·\javaä»£ç å®¡è®¡6.assets\image-20211116160747307.png)



![image-20211116164038020](D:\oneDriveäº‘å­˜å‚¨\OneDrive\æ¡Œé¢\javaä»£ç å®¡è®¡å­¦èµ·\æˆ‘çš„å­¦ä¹ é¡¹ç›®\this_is_my_study\javaä»£ç å®¡è®¡å­¦èµ·\javaä»£ç å®¡è®¡6.assets\image-20211116164038020.png)



![image-20211116164132239](D:\oneDriveäº‘å­˜å‚¨\OneDrive\æ¡Œé¢\javaä»£ç å®¡è®¡å­¦èµ·\æˆ‘çš„å­¦ä¹ é¡¹ç›®\this_is_my_study\javaä»£ç å®¡è®¡å­¦èµ·\javaä»£ç å®¡è®¡6.assets\image-20211116164132239.png)



![image-20211116164225005](D:\oneDriveäº‘å­˜å‚¨\OneDrive\æ¡Œé¢\javaä»£ç å®¡è®¡å­¦èµ·\æˆ‘çš„å­¦ä¹ é¡¹ç›®\this_is_my_study\javaä»£ç å®¡è®¡å­¦èµ·\javaä»£ç å®¡è®¡6.assets\image-20211116164225005.png)



![image-20211116164341488](D:\oneDriveäº‘å­˜å‚¨\OneDrive\æ¡Œé¢\javaä»£ç å®¡è®¡å­¦èµ·\æˆ‘çš„å­¦ä¹ é¡¹ç›®\this_is_my_study\javaä»£ç å®¡è®¡å­¦èµ·\javaä»£ç å®¡è®¡6.assets\image-20211116164341488.png)



![image-20211116164702849](D:\oneDriveäº‘å­˜å‚¨\OneDrive\æ¡Œé¢\javaä»£ç å®¡è®¡å­¦èµ·\æˆ‘çš„å­¦ä¹ é¡¹ç›®\this_is_my_study\javaä»£ç å®¡è®¡å­¦èµ·\javaä»£ç å®¡è®¡6.assets\image-20211116164702849.png)



æµç¨‹ï¼š

![](D:\oneDriveäº‘å­˜å‚¨\OneDrive\æ¡Œé¢\javaä»£ç å®¡è®¡å­¦èµ·\æˆ‘çš„å­¦ä¹ é¡¹ç›®\this_is_my_study\javaä»£ç å®¡è®¡å­¦èµ·\javaä»£ç å®¡è®¡6.assets\60f40319e401fd4fe05480ac.png)

åé¢å°±åˆ°Process

`å°± Process start --ã€‹ProcessImpl.start -ã€‹  return new ProcessImpl --ã€‹  RCE`



### è·å–Classå¯¹è±¡çš„å‡ ç§æ–¹å¼

```java
        //Class<?> run = ClassLoader.getSystemClassLoader().loadClass("java.lang.Runtime");//CLASSå¯¹è±¡
        //Class<?> run = Class.forName("java.lang.Runtime");
        // Class<Runtime> run = Runtime.class;
        // è¿˜æœ‰ ä¸€ç§é€šè¿‡å¯¹è±¡è·å–Classå¯¹è±¡ a = new A(); a.getClass();
```



### è¡¥å……

æ³¨æ„ï¼Œæœ‰â¼€ç‚¹å¾ˆæœ‰è¶£ï¼Œä½¿â½¤åŠŸèƒ½â€.classâ€æ¥åˆ›å»ºClasså¯¹è±¡çš„å¼•â½¤æ—¶ï¼Œä¸ä¼šâ¾ƒåŠ¨åˆå§‹åŒ–è¯¥Classå¯¹ è±¡ï¼Œä½¿â½¤`forName()`ä¼šâ¾ƒåŠ¨åˆå§‹åŒ–è¯¥Classå¯¹è±¡



â¾¸å…ˆè°ƒâ½¤çš„æ˜¯ static {} ï¼Œå…¶æ¬¡æ˜¯ {} ï¼Œæœ€åæ˜¯æ„é€ å‡½æ•°ã€‚ å…¶ä¸­ï¼Œ static {} å°±æ˜¯åœ¨â€œç±»åˆå§‹åŒ–â€çš„æ—¶å€™è°ƒâ½¤çš„ï¼Œâ½½ {} ä¸­çš„ä»£ç ä¼šæ”¾åœ¨æ„é€ å‡½æ•°çš„ super() åâ¾¯ï¼Œ ä½†åœ¨å½“å‰æ„é€ å‡½æ•°å†…å®¹çš„å‰â¾¯ã€‚

å¦‚æœæœ‰ä»»æ„åŠ è½½ç±»çš„æ¥å£ï¼

æˆ‘ä»¬å¯ä»¥ç”¨è¿™ä¸ªç‰¹æ€§è®©ä»–æ‰§è¡Œæˆ‘ä»¬æ¶æ„ç±»ä¸­static ä»£ç ï¼





## åºåˆ—åŒ–

Javaåºåˆ—åŒ–å¯¹è±¡å› å…¶å¯ä»¥æ–¹ä¾¿çš„å°†å¯¹è±¡è½¬æ¢æˆå­—èŠ‚æ•°ç»„ï¼Œåˆå¯ä»¥æ–¹ä¾¿å¿«é€Ÿçš„å°†å­—èŠ‚æ•°ç»„ååºåˆ—åŒ–æˆJavaå¯¹è±¡è€Œè¢«éå¸¸é¢‘ç¹çš„è¢«ç”¨äº`Socket`ä¼ è¾“ã€‚ åœ¨`RMI(Javaè¿œç¨‹æ–¹æ³•è°ƒç”¨-Java Remote Method Invocation)`å’Œ`JMX(Javaç®¡ç†æ‰©å±•-Java Management Extensions)`æœåŠ¡ä¸­å¯¹è±¡**ååºåˆ—åŒ–æœºåˆ¶è¢«å¼ºåˆ¶æ€§ä½¿ç”¨**ã€‚åœ¨`Http`è¯·æ±‚ä¸­ä¹Ÿæ—¶å¸¸ä¼šè¢«ç”¨åˆ°ååºåˆ—åŒ–æœºåˆ¶ï¼Œå¦‚ï¼šç›´æ¥æ¥æ”¶åºåˆ—åŒ–è¯·æ±‚çš„åç«¯æœåŠ¡ã€ä½¿ç”¨Baseç¼–ç åºåˆ—åŒ–å­—èŠ‚å­—ç¬¦ä¸²çš„æ–¹å¼ä¼ é€’ç­‰ã€‚



åœ¨`java`ä¸­ï¼Œååºåˆ—åŒ–å¯¹è±¡æ˜¯é€šè¿‡ç»§æ‰¿`Serializable`æ¥å£æ¥å®ç°çš„ï¼Œåªè¦ä¸€ä¸ªç±»å®ç°äº†`java.io.Serializable`æ¥å£ï¼Œé‚£ä¹ˆå®ƒå°±å¯ä»¥è¢«åºåˆ—åŒ–ã€‚





### é­”æœ¯æ–¹æ³•

åœ¨phpåºåˆ—åŒ–çš„è¿‡ç¨‹ä¸­ï¼Œä¼šåˆ¤æ–­æ˜¯å¦æœ‰`__sleep()`é­”æœ¯æ–¹æ³•ï¼Œå¦‚æœå­˜åœ¨è¿™ä¸ªé­”æœ¯æ–¹æ³•ï¼Œä¼šå…ˆæ‰§è¡Œè¿™ä¸ªæ–¹æ³•ï¼Œååºåˆ—`unserialize()`çš„æ—¶å€™å…ˆæ‰§è¡Œçš„æ˜¯`__wakeup()`é­”æœ¯æ–¹æ³•ã€‚



javaåŒç†ï¼Œ`readObject()`=`__wakeup()`ï¼Œè¿˜æœ‰ä¸€ä¸ª`writeObject()`=`__sleep()`ï¼Œè¿™ä¸¤ä¸ªæ–¹æ³•é»˜è®¤æ˜¯å¯ä»¥ä¸å†™çš„ï¼Œæˆ‘åœ¨ä¸Šé¢çš„ä»£ç ä¸­é‡å†™äº†`readObject()`æ–¹æ³•ï¼Œé€šè¿‡è‡ªå®šä¹‰çš„`writeObject()`å’Œ`readObject()`æ–¹æ³•å¯ä»¥å…è®¸ç”¨æˆ·æ§åˆ¶åºåˆ—åŒ–çš„è¿‡ç¨‹ï¼Œæ¯”å¦‚å¯ä»¥åœ¨åºåˆ—åŒ–çš„è¿‡ç¨‹ä¸­åŠ¨æ€æ”¹å˜åºåˆ—åŒ–çš„æ•°å€¼ã€‚









